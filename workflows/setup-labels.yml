ai-powered-labeling:
    runs-on: ubuntu-latest
    if: github.event.action == 'opened'
    steps:
      - name: Auto-Apply Smart Labels
        uses: actions/github-script@v7
        with:
          script: |
            const issue = context.payload.issue;
            const title = issue.title.toLowerCase();
            const body = (issue.body || '').toLowerCase();
            const repo = context.repo.repo;
            
            const labelsToAdd = [];
            
            // AI-powered label detection
            
            // Revenue opportunity detection
            if (title.includes('$') || title.includes('contract') || title.includes('rfp') || 
                title.includes('revenue') || title.includes('opportunity')) {
              labelsToAdd.push('revenue-opportunity');
            }
            
            // Government contract detection
            if (title.includes('government') || title.includes('dod') || title.includes('army') || 
                title.includes('navy') || title.includes('air force') || title.includes('federal')) {
              labelsToAdd.push('government-rfp');
            }
            
            // Feature development detection
            if (title.includes('feature') || title.includes('add') || title.includes('new') ||
                title.includes('implement') || title.includes('create')) {
              labelsToAdd.push('feature');
            }
            
            // AI/ML detection
            if (title.includes('ai') || title.includes('ml') || title.includes('machine learning') ||
                title.includes('artificial intelligence') || title.includes('automation')) {
              labelsToAdd.push('ai-enhancement');
            }
            
            // Bug detection
            if (title.includes('bug') || title.includes('fix') || title.includes('error') ||
                title.includes('issue') || title.includes('problem')) {
              labelsToAdd.push('bug');
            }
            
            // CMMC/Compliance detection
            if (title.includes('cmmc') || title.includes('compliance') || title.includes('security') ||
                title.includes('certification') || repo === 'cmmc-compliance') {
              labelsToAdd.push('cmmc');
            }
            
            // Priority detection based on value
            if (title.match(/\$[1-9][0-9]*[Mm]/) || title.includes('critical') || title.includes('urgent')) {
              labelsToAdd.push('priority-high');
            } else if (title.match(/\$[1-9][0-9]*[Bb]/) || title.includes('major')) {
              labelsToAdd.push('priority-critical');
            }
            
            // Repository-specific labels
            if (repo === 'core-contracts') {
              labelsToAdd.push('contract-opportunity');
            } else if (repo === 'client-engagement-system') {
              labelsToAdd.push('client-opportunity');
            } else if (repo === 'progredi-cai-m') {
              labelsToAdd.push('defense-contract');
            }
            
            // Apply detected labels
            if (labelsToAdd.length > 0) {
              console.log(`Auto-applying labels: ${labelsToAdd.join(', ')}`);
              
              try {
                await github.rest.issues.addLabels({
                  owner: context.repo.owner,
                  repo: context.repo.repo,
                  issue_number: issue.number,
                  labels: labelsToAdd
                });
                
                // Add a comment explaining the auto-labeling
                const labelComment = `## 🏷️ AI Auto-Labeling Applied
                
                The following labels were automatically applied based on issue analysis:
                ${labelsToAdd.map(label => `- \`${label}\``).join('\n')}
                
                **Reasoning**: Content analysis detected keywords related to these categories.
                
                Feel free to add or remove labels as needed. The project boards will update automatically.
                
                ---
                *🤖 Auto-generated by ProgrediSystems AI labeling system*`;
                
                await github.rest.issues.createComment({
                  issue_number: context.issue.number,
                  owner: context.repo.owner,
                  repo: context.repo.repo,
                  body: labelComment
                });
                
              } catch (error) {
                console.error('Error applying labels:', error);
              }
            }
